<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>知识库收藏列表</title>
    <link rel="stylesheet" href="../../Lib/zui-1.9.1-dist/dist/css/zui.min.css">
    <link rel="stylesheet" href="../../Lib/jsTree/style.min.css">

    <style>
        html {
            background: #EEEEEE;
            height: 98%;
            overflow: hidden;
        }

        .tree ul {
            display: block;
        }

        .tree ul li {
            padding: 0px;
        }

        .tree-anchor>.tree-themeicon {
            margin-top: -12px !important;
        }

        .tree-anchor>span {
            margin-top: -8px !important;
            position: absolute;
        }

        .tree ul li:before {
            height: 0px;
            width: 0px;
            left: 32px;
        }

        .card {
            margin-bottom: 1%;
        }

        #app {
            height: 100%;
        }

        .container-fluid {
            background: #EEEEEE;
            padding: 5px 3% 0 3%;
        }

        .row,
        .col-md-12 {
            height: 100%;
        }

        .card {
            background: #fff;
            width: 100%;
            border-radius: 0;
        }

        .col-md-2 .card {
            min-height: 98%;
        }

        .col-md-10 .card:first-child {
            overflow: inherit;
            padding: 1% 2%;
        }

        .jobsType p,
        .jobsLabel p {
            background: #4690FC;
            color: #fff;
            height: 40px;
            line-height: 40px;
            padding: 0 20px;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
        }

        .jobsType div,
        .jobsLabel div {
            padding: 10px 5px;
        }

        .jobsType div {
            padding-bottom: 0px;
        }

        .jobsType #tag_id a,
        .jobsLabel div a {
            padding: 10px;
            display: inline-table;
            width: 49%;
            text-align: left;
            color: #000;
            font-size: 15px;
        }

        #type_id .leftSelected,
        #tag_id .leftSelected {
            color: #145CCD;
        }

        .imgBox img {
            display: inline-block;
        }

        .list {
            padding: 1% 6%;
        }

        .list .items .item {
            padding: 10px 15px;
        }

        .item-content .text {
            position: relative;
            padding: 0 3.5rem;
            line-height: 25px;
            font-size: 15px;
            letter-spacing: 1px;
        }

        .item-content .text span:first-child {
            position: absolute;
            line-height: 25px;
            left: 0;
        }

        .item-content .text p {
            display: inline;
        }

        .item-heading {
            position: relative;
            cursor: pointer;
        }

        .item-heading>h3:hover {
            color: blueviolet !important;
        }

        .item-heading>h3:-webkit-any-link {
            color: -webkit-link;
            cursor: pointer;
            text-decoration: underline;
        }

        .icon-question-box {
            position: absolute;
            left: -40px;
            /*top: 1px;*/
            display: inline-block;
            width: 28px;
            height: 25px;
            font-style: normal;
            line-height: 28px;
            color: #fff;
            text-align: center;
            /*background-color: #FDBA64;*/
            border-radius: 50%;
        }

        .icon-question {
            font-size: 15px;
        }

        .item-footer .comment:last-child {
            border-bottom: 0;
        }

        .icon-comments {
            color: #808080;
        }

        .exComment {
            color: #145CCD;
        }

        a.avatar {
            display: block;
            width: 40px;
            height: 40px;
            margin-top: 5px !important;
            font-size: 30px;
            line-height: 40px;
            color: #aaa !important;
            text-align: center;
            background-color: #e5e5e5;
            border-radius: 4px;
        }

        .replyBtn {
            float: right;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        h3>a:hover {
            text-decoration: none;
        }

        h3>a:focus {
            text-decoration: none;
        }

        .apply {
            padding: 0 3.5rem;
        }

        .apply span {
            cursor: pointer;
            margin-right: 10px;
            color: #145ccd;
        }

        .apply span:hover {
            color: #0d3d88;
            text-decoration: underline;
        }

        .apply span i {
            margin-right: 5px;
        }

        .tree-anchor>.tree-checkbox {
            top: -11px;
        }

        .father:after {
            content: "";
            height: 0;
            visibility: hidden;
            display: block;
            clear: both;
        }

        .tab-content,
        .tab-pane {
            width: 100%;
            height: 100%;
        }

        #orderFrame {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12" style="height: 100%;">
                <div style="margin-bottom: 10px;">
                    <div class="input-group" style="width: 30%;">
                        <input type="text" class="form-control" id="search" style="border: 1px solid #bfbfbf;" placeholder="请输入标题/关联申请单" v-model="searchKey">
                        <span class="input-group-btn">
                                            <button class="btn btn-default" type="button" onclick="search()"><i
                                                    class="icon icon-search"></i></button>
                                        </span>
                    </div>
                </div>
                <div class="card" style="height: 88.5%;overflow: auto;">
                    <div class="list">
                        <div id="centenr" class="items items-hover">

                        </div>
                        <footer>
                            <ul class="pager" data-ride="pager" id="page">
                            </ul>
                        </footer>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="../../Lib/jquery-3.4.1.min.js" type="text/javascript"></script>
    <script src="../../Lib/zui-1.9.1-dist/dist/js/zui.min.js" type="text/javascript"></script>
    <script src="../../Lib/jsTree/jstree.js"></script>
    <script src="../../Lib/select/jquery.ellipsis.js"></script>
    <script src="../../Lib/public.js"></script>
    <script type="text/javascript">
        var TAG_ID = "";
        var newTrigger = new $.zui.ModalTrigger();
        $(function() {
            getdate();
        });

        //获取数据
        function getdate() {
            var par = {
                'PAGE': 1,
                'recPerPage': 6,
                'KEYWORD': $("#search").val()
            };
            webapi("/approval/getCollectionList", par, function(res) {
                if(res.result == 'success') {
                    for(var i = 0; i < res.data.length; i++) {
                        conenter(res.data[i].KNOWLEDGE_ID, res.data[i].TYPE_ID, res.data[i].TITLE, res.data[i]
                            .CONTENT, res.data[i].CREATE_TIME, res.data[i].YL_NUM);
                    }
                }
                var userListPage = $('#page').data('zui.pager');
                userListPage.set(res.pager.page, res.pager.recTotal, res.pager.recPerPage);
                $('#page').on('onPageChange', function(e, state, oldState) {
                    if(state.page !== oldState.page) {
                        var par = {
                            //'P_TAG_ID': 0,
                            'PAGE': state.page,
                            'recPerPage': 6,
                            //'P_TYPE_ID': 0,
                            'KEYWORD': $("#search").val()
                        };
                        webapi("/approval/getCollectionList", par, function(res) {
                            if(res.result == 'success') {
                                $("#centenr").html("");
                                for(var i = 0; i < res.data.length; i++) {
                                    conenter(res.data[i].KNOWLEDGE_ID, res.data[i].TYPE_ID, res
                                        .data[i].TITLE, res.data[i].CONTENT, res.data[i]
                                        .CREATE_TIME, res.data[i].YL_NUM);
                                }
                            }
                        });
                    }
                });
            });
        }

        function search() {
            getInfobyTagid(1, 6);
        }

        function getInfobyTagid(page, recPerPage) {
            TAG_ID = TAG_ID;
            $(".item-footer").children(".comment,footer").remove();
            $(".exComment").removeClass("exComment");

            var param = {
                'PAGE': page,
                'recPerPage': recPerPage,
                'KEYWORD': $("#search").val()
            };
            webapi("/approval/getCollectionList", param, function(res) {
                if(res.result == 'success') {
                    $("#centenr").html("");
                    for(var i = 0; i < res.data.length; i++) {
                        conenter(res.data[i].KNOWLEDGE_ID, res.data[i].TYPE_ID, res.data[i].TITLE, res.data[i]
                            .CONTENT, res.data[i].CREATE_TIME, res.data[i].YL_NUM);
                    }
                }
                var userListPage = $('#page').data('zui.pager');
                if(res.message == "暂无查询数据") {
                    userListPage.set(1, res.pager.recTotal, 6);
                    return false;
                }
                userListPage.set(
                    res.pager.page,
                    res.pager.recTotal,
                    res.pager.recPerPage
                );
                $('#page').on('onPageChange', function(e, state, oldState) {
                    if(state.page !== oldState.page && that.pageClick != 1) {
                        var par = {
                            'PAGE': state.page,
                            'recPerPage': recPerPage,
                            'KEYWORD': $("#search").val()
                        };
                        webapi("/approval/getCollectionList", par, function(result) {
                            if(result.result == 'success') {
                                $("#centenr").html("");
                                for(var i = 0; i < res.data.length; i++) {
                                    conenter(res.data[i].KNOWLEDGE_ID, res.data[i].TYPE_ID, res
                                        .data[i].TITLE, res.data[i].CONTENT, res.data[i]
                                        .CREATE_TIME, res.data[i].YL_NUM);
                                }
                                $(".item-footer").children(".comment,footer").remove();
                                $(".exComment").removeClass("exComment");
                            }
                        });
                    }
                });
            })
        }

        function conenter(KNOWLEDGE_ID, TYPE_ID, TITLE, CONTENT, CREATE_TIME, TITL) {
            var html = "";
            if(CONTENT == undefined) {
                CONTENT = '<span style="color:#fff;background:red ;">无内容</span>';
            }
            html = '<div class="item father"><div style="width: 85%;float: left;">' +
                '<div onclick="getConent(\'' + KNOWLEDGE_ID + '\',\'' + TYPE_ID + '\')" class="item-heading">' +
                '<h3 style="color: #145ccd;">' +
                '<div class="icon-question-box"><img src="../../Static/Img/gongdan/wenti (1).png" style="height: 28px;width: 28px;"></div>' +
                TITLE + '</h3></div>' +
                '<div class="item-content">' +
                '<div class="textBox">' + CONTENT + '</div>' +
                '</div></div>' +
                '<div style="width: 15%;float: right;">' +
                '<div class="item-content">' +
                '<div class="pull-right"><span style="padding-right: 20px;" class="text-muted">' + CREATE_TIME +
                '</span></div>' +
                '</div><div class="item-content">' +
                '<p class="pull-right" style="padding-right: 20px;" style="color: gray;">浏览次数：<span style="color: green;">' +
                TITL + '</span></p>' +
                '</div></div></div>';
            $("#centenr").append(html);
            $('.textBox').ellipsis({
                row: 2
            });
        }

        function getConent(pid, typeid) {
            num(pid);
            newTrigger.show({
                iframe: '../../Layout/ordinaryUsers/knowledgeBaseConent.html?itemid=' + pid + '&itemtypeid=' + typeid,
                height: $('body').height() * 0.85,
                width: $('body').width() * 0.90,
                title: "解决方案详情"
            });

        }
        //添加浏览次数
        function num(id) {
            var par = {
                'P_ID': id
            };
            webapi("/approval/knowledgeBrowseAdd", par, function(result) {
                if(result.result == 'SUCCESS') {
                    //成功浏览了一次
                }
            });
        }
    </script>

</body>
</html>